using System;
using Microsoft.Win32;

namespace Windows_Vulnerability_Analysis_Tool
{
    public class PC_12
    {
        public int CheckScreenSaverStatus()
        {
            using (RegistryKey key = Registry.CurrentUser.OpenSubKey(@"Control Panel\Desktop"))
            {
                if (key != null)
                {
                    Object o = key.GetValue("ScreenSaveTimeOut");
                    Object p = key.GetValue("ScreenSaverIsSecure");
                    Object q = key.GetValue("SCRNSAVE.EXE");

                    if (o != null && p != null && q != null)
                    {
                        int screenSaveTimeOut;
                        bool parseResult = Int32.TryParse(o.ToString(), out screenSaveTimeOut);

                        if (!parseResult)
                            throw new Exception("화면보호기 대기 시간을 가져오는데 실패했습니다.");

                        bool isTimeoutValid = screenSaveTimeOut <= 600;
                        bool isSecureEnabled = p.ToString() == "1";
                        bool isScreensaverSelected = !string.IsNullOrEmpty(q.ToString());

                        if (isTimeoutValid && isSecureEnabled && isScreensaverSelected)
                        {
                            return 1;
                        }
                        else
                        {
                            return 0;
                        }
                    }
                    else
                    {
                        return 0;
                    }
                }

                throw new Exception("레지스트리 키를 열 수 없습니다.");
            }
        }

        public int SetScreenSaverTimeout()
        {
            try
            {
                int newScreenSaveTimeOut = 600; // 10분 이하로 설정하려면 600 이하의 값을 사용하세요

                using (RegistryKey key = Registry.CurrentUser.OpenSubKey(@"Control Panel\Desktop", true))
                {
                    if (key != null)
                    {
                        key.SetValue("ScreenSaveTimeOut", newScreenSaveTimeOut.ToString());
                        key.SetValue("ScreenSaverIsSecure", "1"); // 화면보호기를 안전하게 설정하려면 "1", 그렇지 않으면 "0"
                                                                  // SCRNSAVE.EXE에는 적절한 화면보호기 프로그램의 경로를 지정해야 합니다.
                        key.SetValue("SCRNSAVE.EXE", "C:\\Windows\\System32\\MyScreenSaver.scr");
                        //Console.WriteLine("화면보호기 설정이 성공적으로 변경되었습니다.");
                        return 1;
                    }
                    else
                    {
                        return 0;
                        //Console.WriteLine("레지스트리 키를 찾을 수 없습니다.");
                    }
                }
            }
            catch (Exception ex)
            {
                return 0;
                //Console.WriteLine($"오류: {ex.Message}");
            }
        }
    }
}