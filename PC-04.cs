using System;
using System.ServiceProcess;

namespace Windows_Vulnerability_Analysis_Tool
{
    public class PC_04
    {
        public int CheckServices()
        {
            string[] servicesToCheck = {
            "Alerter",
            // "wuauserv",  // Automatic Updates
            "ClipSrv",   // Clipbook
            "Browser",   // Computer Browser
            // "CryptSvc",  // Cryptographic Services
            // "Dhcp",      // DHCP Client
            // "TrkWks",    // Distributed Link Tracking Client
            "TrkSvr",    // Distributed Link Tracking Server
            // "Dnscache",  // DNS Client
            "ERSvc",     // Error Reporting Service
            "HidServ",   // Human Interface Device Access
            "ImapiService",  // IMAPI CD-Burning COM Service
            "irmon",     // Infrared Monitor
            "Messenger",
            "mnmsrvc",   // NetMeeting Remote Desktop Sharing
            "WmdmPmSN",  // Portable Media Serial Number
            "Spooler",   // Print Spooler
            "RemoteRegistry", // Remote Registry
            "simptcp",    // Simple TCP/IP Services
            "upnphost",  // Universal Plug and Play Device Host
             "WZCSVC"     // Wireless Zero Configuration
        };

            int result = CheckServicesInternal(servicesToCheck);

            return result;
        }

        private static int CheckServicesInternal(string[] serviceNames)
        {
            int result = 1;

            foreach (var serviceName in serviceNames)
            {
                if (ServiceExists(serviceName))
                {
                    ServiceController service = new ServiceController(serviceName);

                    if (service.Status == ServiceControllerStatus.Running)
                    {
                        result = 0; // At least one service is running
                        break;
                    }
                }
            }

            return result;
        }

        private static bool ServiceExists(string serviceName)
        {
            ServiceController[] services = ServiceController.GetServices();
            return Array.Exists(services, service => service.ServiceName.Equals(serviceName, StringComparison.OrdinalIgnoreCase));
        }
    }

}

