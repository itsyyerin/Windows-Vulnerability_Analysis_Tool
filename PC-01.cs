using Microsoft.Win32;
using System;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows;

namespace Windows_Vulnerability_Analysis_Tool
{
    public class PC_01
    {
        public object CheckPassword()
        {
            using (RegistryKey key = Registry.LocalMachine.OpenSubKey(@"SYSTEM\CurrentControlSet\Services\Netlogon\Parameters"))
            {
                Object Age = key.GetValue("MaximumPasswordAge", "계정 비밀번호 최대 기한값을 찾을 수 없습니다.").ToString();
                key.Close();

                if (Age != null)
                {
                    return Age;
                }
            }
            throw new Exception("윈도우 계정 비밀번호 설정을 찾을 수 없습니다.");
        }

        public int BooleanpasswordPeriod()
        {
            object result = CheckPassword();
            int pwd = Convert.ToInt32(result);

            if (pwd != 0 && pwd < 90)
            {
                return 1;
            }
            else if (pwd > 90 || pwd == 0)
            {
                return 0;
            }
            else
            {
                return 0;
            }
        }

        public void OpenLoginOptions()
        {
            try
            {
                Process.Start("control", "/name Microsoft.UserAccounts /AdministratorPassword");
            }
            catch (Exception ex)
            {
                throw new Exception("윈도우 패스워드 변경 창을 열 수 없습니다.", ex);
            }
        }

        public int EditPasswordPeriod()
        {
            try
            {
                bool isPasswordSet = BooleanpasswordPeriod() == 1;
                if (!isPasswordSet)
                {
                    // 암호가 없는 경우 새로운 암호를 만들기 위한 창을 열도록 수정
                    Process.Start("ms-settings:signinoptions");
                }
                else
                {
                    OpenLoginOptions();
                }
                return 1;
            }
            catch (Exception ex)
            {
                throw new Exception("윈도우 계정 비밀번호 변경이 불가능합니다.", ex);
            }
        }
    }
}