using System;
using System.Collections.Generic;
using System.Linq;
using System.Management;
using System.Text;
using System.Threading.Tasks;

namespace Windows_Vulnerability_Analysis_Tool
{
    public class PC_03
    {


        public int SharedFolder()
        {
            // WMI 쿼리를 통해 로컬 공유 폴더의 정보를 가져옵니다.
            ManagementObjectSearcher searcher = new ManagementObjectSearcher("SELECT * FROM Win32_Share");

            int num = 0;

            foreach (ManagementObject share in searcher.Get())
            {
                string shareName = share["Name"].ToString();
                string sharePath = share["Path"].ToString();
                string description = share["Description"] != null ? share["Description"].ToString() : "";
                string defaultShareDescription = "Default share";
                string defaultShareDescription2 = "기본 공유";

                if (description.IndexOf(defaultShareDescription, StringComparison.OrdinalIgnoreCase) >= 0 ||
                    description.IndexOf(defaultShareDescription2, StringComparison.OrdinalIgnoreCase) >= 0)
                {

                    num++;
                    Console.WriteLine($"취약: {shareName} 폴더가 존재합니다.");

                    // 로컬 공유 폴더의 하위 폴더를 검사
                    //CheckSubFolders(sharePath);
                }
                
            }

            if (num != 0)
            {
                return 0; //공유폴더가 1개 이상 존재하는 경우
            }
            else
            {
                return 1;
            }
        }

        /*
        private static void CheckSubFolders(string folderPath)
        {
            try
            {
                // 로컬 공유 폴더의 하위 폴더들을 가져옴
                string[] subFolders = System.IO.Directory.GetDirectories(folderPath);

                foreach (string subFolder in subFolders)
                {
                    //Console.WriteLine($"하위 폴더 검사: {subFolder}");
                    // 여기에 하위 폴더에 대한 추가적인 검사 로직을 추가할 수 있습니다.
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"에러: {ex.Message}");
            }
        }
        */
    }
}
